<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Staffs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

    body {
      display: flex;
      min-height: 100vh;
      background-color: #f5f7fa;
    }

    /* Reserve space for sidebar 
    #sidebar-placeholder {
      width: 220px;
    }*/

    .main-content {
      margin-left: 220px;
      padding: 30px;
      width: calc(100% - 220px);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background-color: #303032;
      height : 70px;
      color:#fdfbfb ;
    }

    .header h1 {
      font-size: 28px;
    }

    .header a {
      color: #fdfbfb;
      text-decoration: none;
      font-size: 22px;
    }

    .search-bar {
  display: flex;             /* Make it a flex container */
  justify-content: flex-end; /* Push content to the right */
  margin-bottom: 15px;
}

    .search-bar input {
      padding: 8px 12px;
      width: 100%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-radius: 10px;
      overflow: hidden;
    }

    table th, table td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }

    table th {
      background-color: #f0f0f0;
    }

    table tbody tr:hover {
      background-color: #f1f1f1;
      cursor: pointer;
    }

    .delete-btn {
      padding: 6px 12px;
      color: white;
      background-color: #e53935;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      float: right;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      transition: background-color 0.3s;
    }

    .delete-btn:hover {
      background-color: #c62828;
    }

    .edit-btn {
      padding: 6px 12px;
      color: white;
      background-color: #4caf50;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      float: right;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      transition: background-color 0.3s;
    }

    .edit-btn:hover {
      background-color: #388e3c;
    }
  </style>
</head>
<body>

  <!-- Placeholder for Sidebar -->
  <div id="sidebar-placeholder"></div>

  <!-- Main Content -->
  <main class="main-content">
    <div class="header">
      <h1>Manage Staffs</h1>
      <a href="admin.html" title="Go to Home"><i class="fas fa-home"></i></a>
    </div>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by Staff ID..." onkeyup="filterTable()">
    </div>

    <table id="staffTable">
      <thead>
        <tr>
          <th>Staff ID</th>
          <th>Name</th>
          <th>Gender</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Subject</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <!-- JS to Load Sidebar -->
  <script>
    fetch('sidebar.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('sidebar-placeholder').innerHTML = data;
      });
  </script>

  <!-- Main JS -->
  <script>
    let originalStaffList = [];

    document.addEventListener("DOMContentLoaded", function () {
      fetch('mngstaff.php')
        .then(res => res.json())
        .then(data => {
          originalStaffList = data;
          populateStaffTable(data);
        })
        .catch(err => console.error("Error fetching staff:", err));
    });

    function populateStaffTable(staffList) {
      const tbody = document.querySelector('#staffTable tbody');
      tbody.innerHTML = '';
      staffList.forEach(staff => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${staff.staff_id}</td>
          <td contenteditable="false">${staff.name}</td>
          <td>${staff.gender}</td>
          <td contenteditable="false">${staff.phone}</td>
          <td contenteditable="false">${staff.email}</td>
          <td>${staff.subject}</td>
          <td>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" onclick="deleteStaff('${staff.staff_id}')">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Add event listeners for edit functionality
      tbody.querySelectorAll('.edit-btn').forEach(button => {
        button.addEventListener('click', function () {
          const row = this.closest('tr');
          const cells = row.querySelectorAll('td[contenteditable]');

          if (this.textContent === 'Edit') {
            cells.forEach(cell => cell.contentEditable = 'true');
            this.textContent = 'Save';
          } else {
            cells.forEach(cell => cell.contentEditable = 'false');
            this.textContent = 'Edit';

            // Collect data to save
            const staffId = row.cells[0].textContent.trim();
            const name = row.cells[1].textContent.trim();
            const phone = row.cells[3].textContent.trim();
            const email = row.cells[4].textContent.trim();

            // Send data to the server
            fetch('mngstaff.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ staffId, name, phone, email })
            })
            .then(response => {
              console.log('Response status:', response.status);
              return response.text();
            })
            .then(data => {
              console.log('Response data:', data);
              if (data === 'success') {
                alert('Data updated successfully!');
              } else {
                alert('Failed to update data: ' + data);
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('An error occurred while updating data. Check the console for details.');
            });
          }
        });
      });

      // Add event listener for Enter key to save changes
      tbody.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
          event.preventDefault();
          const activeElement = document.activeElement;
          if (activeElement && activeElement.contentEditable === 'true') {
            activeElement.blur();
          }
        }
      });
    }

    function filterTable() {
      const value = document.getElementById("searchInput").value.toLowerCase();
      const filtered = originalStaffList.filter(staff => 
        staff.staff_id.toLowerCase().includes(value)
      );
      populateStaffTable(filtered);
    }

    function deleteStaff(id) {
      if (confirm("Are you sure you want to delete this staff?")) {
        fetch(`mngstaff.php?id=${id}`)
          .then(res => res.text())
          .then(res => {
            alert(res);
            location.reload();
          })
          .catch(err => console.error("Delete error:", err));
      }
    }
  </script>
</body>
</html>
